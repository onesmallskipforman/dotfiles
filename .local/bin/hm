#!/bin/zsh

# script to turn home manager on and off

function init() {
  nix run --show-trace home-manager/master -- init
}

function on() {
  nix-env --switch-profile $XDG_STATE_HOME/nix/profiles/home-manager
  nix run --show-trace home-manager/master -- switch -b backup
}

function off() {
  nix run --show-trace home-manager/master -- switch -b backup
  nix-env --switch-profile $XDG_STATE_HOME/nix/profiles/profile
  mv -fT ~/.mozilla/firefox/profiles.ini.backup ~/.mozilla/firefox/profiles.ini
  # TODO: this cleanup is overkill for tuning off HM. Move this to cleanup script
  # Also these commands are clearing out devenvs which I don't want
  # nix store gc
  # nix store optimise
}

case $1 in
  on  ) on  ;;
  off ) off ;;
  init) init;;
  *  ) echo 'hm (on|off|init)'; exit 1 ;;
esac
