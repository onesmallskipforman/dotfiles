#!/bin/sh

#===============================================================================
# DESKTOP ENV SETUP
#===============================================================================

# Set Dock
function dockset() {
  dockutil --no-restart --remove all
  dockutil --no-restart --add "/System/Applications/Mail.app"
  dockutil --no-restart --add "/System/Applications/Messages.app"
  dockutil --no-restart --add "/Applications/XCTU.app"
  dockutil --no-restart --add "/Applications/Visual Studio Code.app"
  dockutil --no-restart --add "/Applications/Spotify.app"
  dockutil --no-restart --add "/Applications/Minecraft.app"
  dockutil --no-restart --add "/Applications/Firefox.app"
  dockutil --no-restart --add "/Applications/MATLAB_R2019b.app"
  dockutil --no-restart --add "/Applications/Mathematica.app"
  dockutil --no-restart --add "/Applications/CoolTerm.app"
  dockutil --no-restart --add "/Applications/kitty.app"
  dockutil --no-restart --add "/Applications/Alacritty.app"
  dockutil --no-restart --add "$HOME/Downloads" --view fan --display stack --sort dateadded
  killall Dock
}
dockset &

# Set a custom wallpaper image
WALLPAPER="$HOME/.local/share/wallpapers/beams.jpeg"
osascript -e "tell application \"Finder\" to set desktop picture to \"$(realpath "$WALLPAPER")\" as POSIX file"
osascript -e "tell application \"System Events\" to tell every desktop to set picture to \"$(realpath "$WALLPAPER")\""

# ensure dmenu, ubersicht bar, and redshift are running
pgrep dmenu-mac &>/dev/null || open -a dmenu-mac
pgrep Übersicht &>/dev/null || open -a Übersicht
pgrep redshift  &>/dev/null || redshift &

#===============================================================================
# WM SETUP
#===============================================================================

# global settings
yabai -m config mouse_follows_focus          off #on
yabai -m config focus_follows_mouse          off #autoraise
yabai -m config window_placement             second_child
yabai -m config window_topmost               on
yabai -m config window_opacity               on
yabai -m config window_opacity_duration      0.0
yabai -m config window_shadow                off
yabai -m config window_border                on
yabai -m config window_border_placement      inset
yabai -m config window_border_width          4
yabai -m config window_border_radius         0
yabai -m config active_window_border_topmost on
yabai -m config active_window_border_color   0xffa89984
yabai -m config normal_window_border_color   0xff3c3836
yabai -m config insert_window_border_color   0xffd75f5f
yabai -m config active_window_opacity        1.0
yabai -m config normal_window_opacity        0.9
yabai -m config split_ratio                  0.50
yabai -m config auto_balance                 off
yabai -m config mouse_modifier               fn
yabai -m config mouse_action1                move
yabai -m config mouse_action2                resize

# general space settings
yabai -m config layout                       bsp
yabai -m config top_padding                  40
yabai -m config bottom_padding               40
yabai -m config left_padding                 40
yabai -m config right_padding                40
yabai -m config window_gap                   10

# Special Rules for managing Mission Control with skhd
yabai -m signal --add event=mission_control_enter action="skhd -k \"ctrl - m\""
yabai -m signal --add event=mission_control_exit  action="skhd -k \"ctrl - m\""
